(function(h){function l(c,a,k,m){var b=h(c).data("originalFragments"),i=0,e;for(e=0;e<b.length;++e)c=b[e],h("#"+c.id).fadeTo(a,k,function(){i+=1;i===b.length&&m()})}function n(c,a,k,m,b){var i=h(a),e=i.data("originalFragments"),d=0,g,j,f;for(f=0;f<e.length;++f){a=e[f];g=a.left;j=a.top;switch(Math.floor(4*Math.random())+0){case 0:g=-a.width;break;case 1:g=k;break;case 2:j=-a.height;break;case 3:j=m}h("#"+a.id).delay(f*c).animate({left:g,top:j},750,function(){d+=1;d===e.length&&(i.css("visibility",
"hidden"),b())})}}h.fn.slideandfade=function(c,a){var k=h.extend({callback:function(){}},a);return this.each(function(){function a(b,g){var c=d.currentDisplayBox,f;f=function(){var a=h(b),c=a.data("originalFragments"),f=0,e;a.css("visibility","visible");for(e=0;e<c.length;++e)a=c[e],h("#"+a.id).delay(100*e).animate({left:a.left,top:a.top},750,function(){f+=1;f===c.length&&l(b,250,1,function(){d.busy=!1;g()})})};d.currentDisplayBox=b;l(c,250,0.2,function(){n(100,c,i,e,f)})}var b=h(this),i=b.width(),
e=b.height(),d=b.data("nspace"),g;void 0===d&&(g=h(".displayBox",this),d={currentDisplayBox:g[0],busy:!1,haveScatteredFragments:!1,displayBoxes:g},b.data("nspace",d),d.displayBoxes.each(function(){var a=h(this),d=[];a.children(".fragment").each(function(a){var b=h(this),c={};c.id=b.attr("id");c.width=b.width();c.height=b.height();c.top=b.position().top;c.left=b.position().left;d[a]=c});a.data("originalFragments",d)}));var j=k.callback,f;if(!d.busy)if(d.busy=!0,!d.haveScatteredFragments||void 0===
c){d.haveScatteredFragments=!0;f=0;g=function(){++f;f===2*d.displayBoxes.length&&(void 0===c?(d.busy=!1,j()):a(c,j))};for(b=0;b<d.displayBoxes.length;++b)n(0,d.displayBoxes[b],i,e,g),l(d.displayBoxes[b],0,0.2,g)}else a(c,j)})}})(jQuery);
