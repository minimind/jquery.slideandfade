(function(h){function n(f,b,k,l){var c=f.data("originalFragments"),g=0,a,d=function(){g+=1;g===c.length&&l()};for(a=0;a<c.length;++a)f=c[a],h("#"+f.id).fadeTo(b,k,d)}function q(f,b,k,l,c){var g=b.data("originalFragments"),a=0,d,m,i,j,r=function(){a+=1;a===g.length&&(b.css("visibility","hidden"),c())};for(j=0;j<g.length;++j){d=g[j];m=d.left;i=d.top;switch(Math.floor(4*Math.random())+0){case 0:m=-d.width;break;case 1:m=k;break;case 2:i=-d.height;break;case 3:i=l}h("#"+d.id).delay(j*f).animate({left:m,
top:i},750,r)}}h.fn.slideandfade=function(f,b){var k,l,c,g,a=h(f),d=h.extend({callback:function(){}},b);return this.each(function(){function m(d,g){var a=e.currentDisplayBox,c=function(){var a=d.data("originalFragments"),c=0,f,b,i=function(){c+=1;c===a.length&&n(d,250,1,function(){e.busy=!1;g()})};d.css("visibility","visible");for(b=0;b<a.length;++b)f=a[b],h("#"+f.id).delay(100*b).animate({left:f.left,top:f.top},750,i)};e.currentDisplayBox=d;n(a,250,0.2,function(){q(100,a,j,b,c)})}var i=h(this),j=
i.width(),b=i.height(),e=i.data("nspace"),p;void 0===e&&(p=h(".displayBox",this),e={currentDisplayBox:h(p[0]),busy:!1,haveScatteredFragments:!1,displayBoxes:p},i.data("nspace",e),e.displayBoxes.each(function(){var a=h(this),d=[];a.children(".fragment").each(function(a){var c=h(this),b={};b.id=c.attr("id");b.width=c.width();b.height=c.height();b.top=c.position().top;b.left=c.position().left;d[a]=b});a.data("originalFragments",d)}));if(!e.busy)if(e.busy=!0,!e.haveScatteredFragments||void 0===f){e.haveScatteredFragments=
!0;k=0;l=function(){++k;k===2*e.displayBoxes.length&&(void 0===f?(e.busy=!1,d.callback()):m(a,d.callback))};for(c=0;c<e.displayBoxes.length;++c)g=h(e.displayBoxes[c]),q(0,g,j,b,l),n(g,0,0.2,l)}else m(a,d.callback)})}})(jQuery);
