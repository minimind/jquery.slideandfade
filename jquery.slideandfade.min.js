(function(d){function l(i,c,k,m){function j(){a+=1;a===g.length&&m()}var g=d(i).data("originalFragments"),a=0,b;for(b=0;b<g.length;++b)i=g[b],d("#"+i.id).fadeTo(c,k,j)}function n(i,c,k,m,j){var g=d(c),a=g.data("originalFragments"),b=0,f,h,e,p;p=function(){b+=1;b===a.length&&(g.css("visibility","hidden"),j())};for(e=0;e<a.length;++e){c=a[e];f=c.left;h=c.top;switch(Math.floor(4*Math.random())+0){case 0:f=-c.width;break;case 1:f=k;break;case 2:h=-c.height;break;case 3:h=m}d("#"+c.id).delay(e*i).animate({left:f,
top:h},750,p)}}d.fn.slideandfade=function(i,c){var k=d.extend({callback:function(){}},c);return this.each(function(){function c(b,i){var e=a.currentDisplayBox,f;f=function(){var c=function(){f+=1;f===e.length&&l(b,250,1,function(){a.busy=!1;i()})},e=d(b).data("originalFragments"),f=0,g,h;d(b).css("visibility","visible");for(h=0;h<e.length;++h)g=e[h],d("#"+g.id).delay(100*h).animate({left:g.left,top:g.top},750,c)};a.currentDisplayBox=b;l(e,250,0.2,function(){n(100,e,j,g,f)})}var j=parseInt(d(this).css("width"),
10),g=parseInt(d(this).css("height"),10),a=d(this).data("nspace"),b;void 0===a&&(b=d(".displayBox",this),a={currentDisplayBox:b[0],busy:!1,haveScatteredFragments:!1,displayBoxes:b},d(this).data("nspace",a),a.displayBoxes.each(function(){var a=[];d(this).children(".fragment").each(function(b){var c={};c.id=d(this).attr("id");c.width=parseInt(d(this).css("width"),10);c.height=parseInt(d(this).css("height"),10);c.top=parseInt(d(this).css("top"),10);c.left=parseInt(d(this).css("left"),10);a[b]=c});d(this).data("originalFragments",
a)}));var f=k.callback,h,e;if(!a.busy)if(a.busy=!0,!a.haveScatteredFragments||void 0===i){a.haveScatteredFragments=!0;h=0;e=function(){++h;h===2*a.displayBoxes.length&&(void 0===i?(a.busy=!1,f()):c(i,f))};for(b=0;b<a.displayBoxes.length;++b)n(0,a.displayBoxes[b],j,g,e),l(a.displayBoxes[b],0,0.2,e)}else c(i,f)})}})(jQuery);
