(function(c){function l(i,e,k,m){function j(){b+=1;b===f.length&&m()}var f=c(i).data("originalFragments"),b=0,a;for(a=0;a<f.length;++a)i=f[a],c("#"+i.id).fadeTo(e,k,j)}function n(i,e,k,m,j){var f=c(e).data("originalFragments"),b=0,a,d,g,h,p;p=function(){b+=1;b===f.length&&(c(e).css("visibility","hidden"),j())};for(h=0;h<f.length;++h){a=f[h];d=a.left;g=a.top;switch(Math.floor(4*Math.random())+0){case 0:d=-a.width-5;break;case 1:d=k+5;break;case 2:g=-a.height-5;break;case 3:g=m+5}c("#"+a.id).delay(h*
i).animate({left:d,top:g},750,p)}}c.fn.slideandfade=function(i,e){var k=c.extend({callback:function(){}},e);return this.each(function(){function e(a,i){var h=b.currentDisplayBox,d;d=function(){var h=function(){f+=1;f===d.length&&l(a,250,1,function(){b.busy=!1;i()})},d=c(a).data("originalFragments"),f=0,e,g;c(a).css("visibility","visible");for(g=0;g<d.length;++g)e=d[g],c("#"+e.id).delay(100*g).animate({left:e.left,top:e.top},750,h)};b.currentDisplayBox=a;l(h,250,0.2,function(){n(100,h,j,f,d)})}var j=
parseInt(c(this).css("width")),f=parseInt(c(this).css("height")),b=c(this).data("nspace"),a;void 0===b&&(a=c(".displayBox",this),b={currentDisplayBox:a[0],busy:!1,haveScatteredFragments:!1,displayBoxes:a},c(this).data("nspace",b),b.displayBoxes.each(function(){var a=[];c(this).children(".fragment").each(function(b){var d={};d.id=c(this).attr("id");d.width=parseInt(c(this).css("width"),10);d.height=parseInt(c(this).css("height"),10);d.top=parseInt(c(this).css("top"),10);d.left=parseInt(c(this).css("left"),
10);a[b]=d});c(this).data("originalFragments",a)}));var d=k.callback,g,h;if(!b.busy)if(b.busy=!0,!b.haveScatteredFragments||void 0===i){b.haveScatteredFragments=!0;g=0;h=function(){++g;g===2*b.displayBoxes.length&&(void 0===i?(b.busy=!1,d()):e(i,d))};for(a=0;a<b.displayBoxes.length;++a)n(0,b.displayBoxes[a],j,f,h),l(b.displayBoxes[a],0,0.2,h)}else e(i,d)})}})(jQuery);
