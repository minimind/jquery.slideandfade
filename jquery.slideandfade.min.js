(function(c){function l(i,b,k,m){var g=c(i).data("originalFragments"),h=0,a;for(a=0;a<g.length;++a)i=g[a],c("#"+i.id).fadeTo(b,k,function(){h+=1;h===g.length&&m()})}function n(i,b,k,m,g){var h=c(b),a=h.data("originalFragments"),d=0,f,j,e,p;p=function(){d+=1;d===a.length&&(h.css("visibility","hidden"),g())};for(e=0;e<a.length;++e){b=a[e];f=b.left;j=b.top;switch(Math.floor(4*Math.random())+0){case 0:f=-b.width;break;case 1:f=k;break;case 2:j=-b.height;break;case 3:j=m}c("#"+b.id).delay(e*i).animate({left:f,
top:j},750,p)}}c.fn.slideandfade=function(i,b){var k=c.extend({callback:function(){}},b);return this.each(function(){function b(d,i){var e=a.currentDisplayBox,f;f=function(){var b=function(){f+=1;f===e.length&&l(d,250,1,function(){a.busy=!1;i()})},e=c(d).data("originalFragments"),f=0,h,g;c(d).css("visibility","visible");for(g=0;g<e.length;++g)h=e[g],c("#"+h.id).delay(100*g).animate({left:h.left,top:h.top},750,b)};a.currentDisplayBox=d;l(e,250,0.2,function(){n(100,e,g,h,f)})}var g=c(this).width(),
h=c(this).height(),a=c(this).data("nspace"),d;void 0===a&&(d=c(".displayBox",this),a={currentDisplayBox:d[0],busy:!1,haveScatteredFragments:!1,displayBoxes:d},c(this).data("nspace",a),a.displayBoxes.each(function(){var a=[];c(this).children(".fragment").each(function(d){var b={};b.id=c(this).attr("id");b.width=c(this).width();b.height=c(this).height();b.top=c(this).position().top;b.left=c(this).position().left;a[d]=b});c(this).data("originalFragments",a)}));var f=k.callback,j,e;if(!a.busy)if(a.busy=
!0,!a.haveScatteredFragments||void 0===i){a.haveScatteredFragments=!0;j=0;e=function(){++j;j===2*a.displayBoxes.length&&(void 0===i?(a.busy=!1,f()):b(i,f))};for(d=0;d<a.displayBoxes.length;++d)n(0,a.displayBoxes[d],g,h,e),l(a.displayBoxes[d],0,0.2,e)}else b(i,f)})}})(jQuery);
