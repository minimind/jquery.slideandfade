(function(d){function l(e,b,k,m){var a=d(e).data("originalFragments"),i=0,f;for(f=0;f<a.length;++f)e=a[f],d("#"+e.id).fadeTo(b,k,function(){i+=1;i===a.length&&m()})}function n(e,b,k,m,a){var i=d(b),f=i.data("originalFragments"),c=0,h,j,g;for(g=0;g<f.length;++g){b=f[g];h=b.left;j=b.top;switch(Math.floor(4*Math.random())+0){case 0:h=-b.width;break;case 1:h=k;break;case 2:j=-b.height;break;case 3:j=m}d("#"+b.id).delay(g*e).animate({left:h,top:j},750,function(){c+=1;c===f.length&&(i.css("visibility",
"hidden"),a())})}}d.fn.slideandfade=function(e,b){var k=d.extend({callback:function(){}},b);return this.each(function(){function b(a,h){var e=c.currentDisplayBox,g;g=function(){var b=d(a),e=b.data("originalFragments"),g=0,f;b.css("visibility","visible");for(f=0;f<e.length;++f)b=e[f],d("#"+b.id).delay(100*f).animate({left:b.left,top:b.top},750,function(){g+=1;g===e.length&&l(a,250,1,function(){c.busy=!1;h()})})};c.currentDisplayBox=a;l(e,250,0.2,function(){n(100,e,i,f,g)})}var a=d(this),i=a.width(),
f=a.height(),c=a.data("nspace"),h;void 0===c&&(h=d(".displayBox",this),c={currentDisplayBox:h[0],busy:!1,haveScatteredFragments:!1,displayBoxes:h},a.data("nspace",c),c.displayBoxes.each(function(){var b=[];d(this).children(".fragment").each(function(c){var a={};a.id=d(this).attr("id");a.width=d(this).width();a.height=d(this).height();a.top=d(this).position().top;a.left=d(this).position().left;b[c]=a});d(this).data("originalFragments",b)}));var j=k.callback,g;if(!c.busy)if(c.busy=!0,!c.haveScatteredFragments||
void 0===e){c.haveScatteredFragments=!0;g=0;h=function(){++g;g===2*c.displayBoxes.length&&(void 0===e?(c.busy=!1,j()):b(e,j))};for(a=0;a<c.displayBoxes.length;++a)n(0,c.displayBoxes[a],i,f,h),l(c.displayBoxes[a],0,0.2,h)}else b(e,j)})}})(jQuery);
